package net.breezeware.carejoy.graph.dao;

import java.util.List;
import java.util.Set;
import java.util.UUID;

import org.springframework.data.neo4j.annotation.Query;
import org.springframework.data.neo4j.repository.Neo4jRepository;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import net.breezeware.carejoy.graph.entity.clinical.VitalSign;

@Repository
public interface VitalSignsRepository extends Neo4jRepository<VitalSign, Long> {

    @Query("match pa=(p:Patient{uuid:{uuid}})-[*0..10]->(n) WITH *, relationships(pa) as relList WHERE n.entityState='active' AND ANY(rel in relList WHERE type(rel)=\"HAS_VITALS\") return p,relList,n")
    List<VitalSign> findVitalSignByUuid(@Param("uuid") UUID uuid);

    @Query("MATCH (n:VitalSign) WHERE n.uuid IN {uuidList} SET n.entityState = {entityState} RETURN n")
    void updateEntityState(@Param("uuidList") Set<UUID> uuidList, @Param("entityState") String entityState);
}