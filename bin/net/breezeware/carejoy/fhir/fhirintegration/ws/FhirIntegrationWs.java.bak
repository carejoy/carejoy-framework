package net.breezeware.carejoy.fhir.fhirintegration.ws;

import io.swagger.annotations.Api;

import io.swagger.annotations.ApiOperation;

import javax.ws.rs.Consumes;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.MediaType;

import net.breezeware.carejoy.fhir.exception.FhirException;
import net.breezeware.carejoy.fhir.fhirbase.service.api.FhirBaseService;
import net.breezeware.carejoy.fhir.fhirintegration.dto.FhirImportDto;
import net.breezeware.carejoy.fhir.fhirintegration.service.api.FhirIntegrationService;
import net.breezeware.carejoy.fhir.fhirintegration.service.impl.CernerFhirClientServiceImpl;
import net.breezeware.carejoy.fhir.fhirintegration.service.impl.OpenEpicFhirClientServiceImpl;
import net.breezeware.carejoy.fhir.pgfhir.ws.FhirWs;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

/**
 * 
 * @author karthikcm_cse
 * 
 */
@Component
@Path("api/fhirintegration")
@Api(value = "FHIR Integration Service")
public class FhirIntegrationWs {

    Logger logger = LoggerFactory.getLogger(FhirWs.class);

    public final String FHIR_SOURCE_OPENEPIC = "OPENEPIC";
    public final String FHIR_SOURCE_CERNER = "CERNER";

    @Autowired
    FhirIntegrationService fhirIntegrationService;

    @Autowired
    CernerFhirClientServiceImpl cernerFhirClientServiceImpl;

    @Autowired
    OpenEpicFhirClientServiceImpl openEpicFhirClientServiceImpl;

    @Autowired
    FhirBaseService fhirBaseService;

    /**
     * Imports an FHIR resource from the server specified into the local
     * FHIRBase DB.
     * 
     * @param source
     * @param serverBaseUrl
     * @param resourceType
     * @param resourceId
     * @return
     * @throws FhirException
     */
    @POST
    @Path("import")
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    @ApiOperation(value = "Imports a FHIR resource")
    public String importFhirResourceFromServer(@QueryParam("source") String source,
            @QueryParam("serverBaseUrl") String serverBaseUrl, @QueryParam("resourceType") String resourceType,
            @QueryParam("resourceId") String resourceId) throws FhirException {

        String retVal = "";
        FhirImportDto fhirImportDto = new FhirImportDto();
        fhirImportDto.setFhirSource(source);
        fhirImportDto.setResourceBaseUrl(serverBaseUrl);
        fhirImportDto.setResourceType(resourceType);
        fhirImportDto.setResourceId(resourceId);
        fhirImportDto.setTargetStore("fhirbase");

        fhirIntegrationService.importResource(fhirImportDto);

        return retVal;
    }
}